<%- include('partials/header') %>
<main>
  <h1>SLGS Stats</h1>

  <h3>
    Lookup Drafter Profile (Just first name or first name first initial with no
    space in between)
  </h3>
  <form action="/search" method="GET">
    <input
      type="text"
      name="query"
      placeholder="Search for a drafter"
      required
    />
    <button type="submit">Search</button>
  </form>

  <div class="content">
    <h2>Season XIII (10/2/25 - 12/18/25)</h2>
  </div>
  <div class="data-table-container">
    <div class="data-table">
      <p>
        71 Drafts in, last updated 12/18/25<br />

        Congrats to our Winrate and Gauntlet Champion Erik Cearns!!<br />
        Season XIV will last from 12/28/25 to 3/26/26. Stats will be updated
        once there is enough data (probably after the 1/10 drafts)
      </p>
      <table id="sortableTable">
        <thead>
          <tr>
            <% if(tableData.length > 0) { %> <%
            Object.keys(tableData[0]).forEach(function(key) { %>
            <th class="sortable" data-key="<%= key %>">
              <%= key %>
              <span class="sort-indicator"></span>
            </th>
            <% }); %> <% } %>
          </tr>
        </thead>
<tbody>
  <% tableData.forEach(function(row) { 
       let rowClass = '';

       // Bold rows with >= 16 drafts
       if (row.total_drafts >= 16) {
         rowClass += ' bold-row';
       }

       // Highlight specific players
       if (row.name === 'Eric K') {
         rowClass += ' gold-row';
       } else if (row.name === 'Clayton') {
         rowClass += ' silver-row';
       } else if (row.name === 'Walski') {
         rowClass += ' bronze-row';
       }
  %>
    <tr class="<%= rowClass.trim() %>">
      <% Object.values(row).forEach(function(value) { %>
        <td><%= value %></td>
      <% }); %>
    </tr>
  <% }); %>
</tbody>

      </table>
    </div>
  </div>

  <div class="data-table-container">
    <div class="data-table">
      <h2>Gauntlet Rankings</h2>
      <table>
        <thead>
          <tr>
            <% if(gauntletData.length > 0) { %> <%
            Object.keys(gauntletData[0]).forEach(function(key) { %>
            <th><%= key %></th>
            <% }); %> <% } %>
          </tr>
        </thead>
        <tbody>
          <% const keys = Object.keys(gauntletData[0]); const cubeDraftsIndex =
          keys.indexOf("cube_drafts"); const retailDraftsIndex =
          keys.indexOf("retail/chaos_drafts");
          gauntletData.forEach(function(row) { const values =
          Object.values(row); %>
          <tr>
            <% values.forEach(function(value, i) { %>
            <td>
              <% if (i === cubeDraftsIndex && value === '4') { %>
              <strong><%= value %></strong>
              <% } else if (i === retailDraftsIndex && value === '12') { %>
              <strong><%= value %></strong>
              <% } else { %> <%= value %> <% } %>
            </td>
            <% }); %>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>
</main>

<%- include('partials/footer') %>
